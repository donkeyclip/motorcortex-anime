!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@donkeyclip/motorcortex")):"function"==typeof define&&define.amd?define(["@donkeyclip/motorcortex"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["@donkeyclip/motorcortex-anime"]=e(t.MotorCortex)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=e(t),n={},a={duration:1e3,round:0},o=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],i={CSS:{}};function u(t,e,r){return Math.min(Math.max(t,e),r)}function s(t,e){return t.indexOf(e)>-1}var c={arr:function(t){return Array.isArray(t)},obj:function(t){return s(Object.prototype.toString.call(t),"Object")},pth:function(t){return c.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return t.nodeType||c.svg(t)},str:function(t){return"string"==typeof t},fnc:function(t){return"function"==typeof t},und:function(t){return void 0===t},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return c.hex(t)||c.rgb(t)||c.hsl(t)},key:function(t){return!n.hasOwnProperty(t)&&!a.hasOwnProperty(t)&&"targets"!==t&&"keyframes"!==t}},f={linear:function(){return function(t){return t}}};function l(t,e){for(var r=t.length,n=arguments.length>=2?arguments[1]:void 0,a=[],o=0;o<r;o++)if(o in t){var i=t[o];e.call(n,i,o,t)&&a.push(i)}return a}function d(t){return t.reduce((function(t,e){return t.concat(c.arr(e)?d(e):e)}),[])}function h(t){return c.arr(t)?t:(c.str(t)&&(t=function(t){try{return document.querySelectorAll(t)}catch(t){return}}(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function p(t,e){return t.some((function(t){return t===e}))}function g(t){var e={};for(var r in t)e[r]=t[r];return e}function m(t,e){var r=g(t);for(var n in t)r[n]=e.hasOwnProperty(n)?e[n]:t[n];return r}function v(t,e){var r=g(t);for(var n in e)r[n]=c.und(t[n])?e[n]:t[n];return r}function y(t){return c.rgb(t)?(r=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e=t))?"rgba("+r[1]+",1)":e:c.hex(t)?function(t){var e=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,r,n){return e+e+r+r+n+n})),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgba("+parseInt(r[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+",1)"}(t):c.hsl(t)?function(t){var e,r,n,a=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),o=parseInt(a[1],10)/360,i=parseInt(a[2],10)/100,u=parseInt(a[3],10)/100,s=a[4]||1;function c(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}if(0==i)e=r=n=u;else{var f=u<.5?u*(1+i):u+i-u*i,l=2*u-f;e=c(l,f,o+1/3),r=c(l,f,o),n=c(l,f,o-1/3)}return"rgba("+255*e+","+255*r+","+255*n+","+s+")"}(t):void 0;var e,r}function b(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function x(t,e){return c.fnc(t)?t(e.target,e.id,e.total):t}function w(t,e){return t.getAttribute(e)}function P(t,e,r){if(p([r,"deg","rad","turn"],b(e)))return e;var n=i.CSS[e+r];if(!c.und(n))return n;var a=document.createElement(t.tagName),o=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=100+r;var u=100/a.offsetWidth;o.removeChild(a);var s=u*parseFloat(e);return i.CSS[e+r]=s,s}function C(t,e,r){if(e in t.style){var n=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),a=t.style[e]||getComputedStyle(t).getPropertyValue(n)||"0";return r?P(t,a,r):a}}function k(t,e){return c.dom(t)&&!c.inp(t)&&(w(t,e)||c.svg(t)&&t[e])?"attribute":c.dom(t)&&p(o,e)?"transform":c.dom(t)&&"transform"!==e&&C(t,e)?"css":null!=t[e]?"object":void 0}function M(t){if(c.dom(t)){for(var e,r=t.style.transform||"",n=/(\w+)\(([^)]*)\)/g,a=new Map;e=n.exec(r);)a.set(e[1],e[2]);return a}}function S(t,e,r,n){var a=s(e,"scale")?1:0+function(t){return s(t,"translate")||"perspective"===t?"px":s(t,"rotate")||s(t,"skew")?"deg":void 0}(e),o=M(t).get(e)||a;return r&&(r.transforms.list.set(e,o),r.transforms.last=e),n?P(t,o,n):o}function A(t,e,r,n){switch(k(t,e)){case"transform":return S(t,e,n,r);case"css":return C(t,e,r);case"attribute":return w(t,e);default:return t[e]||0}}function I(t,e){var r=/^(\*=|\+=|-=)/.exec(t);if(!r)return t;var n=b(t)||0,a=parseFloat(e),o=parseFloat(t.replace(r[0],""));switch(r[0][0]){case"+":return a+o+n;case"-":return a-o+n;case"*":return a*o+n}}function E(t,e){if(c.col(t))return y(t);if(/\s/g.test(t))return t;var r=b(t),n=r?t.substr(0,t.length-r.length):t;return e?n+e:n}function O(t,e){var r=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=E(c.pth(t)?t.totalLength:t,e)+"";return{original:n,numbers:n.match(r)?n.match(r).map(Number):[0],strings:c.str(t)||e?n.split(r):[]}}function T(t){var e=function(t){return l(t?d(c.arr(t)?t.map(h):h(t)):[],(function(t,e,r){return r.indexOf(t)===e}))}(t);return e.map((function(t,r){return{target:t,id:r,total:e.length,transforms:{list:M(t)}}}))}function j(t,e){var r=g(e);if(c.arr(t)){var n=t.length;2===n&&!c.obj(t[0])?t={value:t}:c.fnc(e.duration)||(r.duration=e.duration/n)}return(c.arr(t)?t:[t]).map((function(t,e){return c.obj(t)&&!c.pth(t)?t:{value:t}})).map((function(t){return v(t,r)}))}function L(t,e){var r;return t.tweens.map((function(n){var a=function(t,e){var r={};for(var n in t){var a=x(t[n],e);c.arr(a)&&1===(a=a.map((function(t){return x(t,e)}))).length&&(a=a[0]),r[n]=a}return r.duration=parseFloat(r.duration),r}(n,e),o=a.value,i=c.arr(o)?o[1]:o,u=b(i),s=A(e.target,t.name,u,e),f=r?r.to.original:s,l=c.arr(o)?o[0]:f,d=b(l)||b(s),h=u||d;return c.und(i)&&(i=f),a.from=O(l,h),a.to=O(I(i,l),h),a.start=r?r.end:0,a.end=a.start+a.duration,a.isPath=!1,a.isColor=c.col(a.from.original),a.isColor&&(a.round=1),r=a,a}))}var V={css:function(t,e,r){return t.style[e]=r},attribute:function(t,e,r){return t.setAttribute(e,r)},object:function(t,e,r){return t[e]=r},transform:function(t,e,r,n,a){if(n.list.set(e,r),e===n.last||a){var o="";n.list.forEach((function(t,e){o+=e+"("+t+") "})),t.style.transform=o}}};function N(t,e){T(t).forEach((function(t){for(var r in e){var n=x(e[r],t),a=t.target,o=b(n),i=A(a,r,o,t),u=I(E(n,o||b(i)),i),s=k(a,r);V[s](a,r,u,t.transforms,!0)}}))}function F(t,e){return l(d(t.map((function(t){return e.map((function(e){return function(t,e){var r=k(t.target,e.name);if(r){var n=L(e,t),a=n[n.length-1];return{type:r,property:e.name,animatable:t,tweens:n,duration:a.end}}}(t,e)}))}))),(function(t){return!c.und(t)}))}var $=0;function G(t){var e=m(n,t),r=m(a,t),o=function(t,e){var r=[];for(var n in e)c.key(n)&&r.push({name:n,tweens:j(e[n],t)});return r}(r,t),i=T(t.targets),u=F(i,o),s=function(t,e){var r=t.length,n={};return n.duration=r?Math.max.apply(Math,t.map((function(t){return t.duration}))):e.duration,n}(u,r),f=$;return $++,v(e,{id:f,children:[],animatables:i,animations:u,duration:s.duration})}function X(t){void 0===t&&(t={});var e,r=0,n=null;function a(t){var e=window.Promise&&new Promise((function(t){return n=t}));return t.finished=e,e}var o=G(t);function i(t,e){e&&e.seek(t)}function s(t){var s=o.duration,c=t;o.progress=u(c/s*100,0,100),o.reversePlayback=c<o.currentTime,e&&function(t){if(o.reversePlayback)for(var n=r;n--;)i(t,e[n]);else for(var a=0;a<r;a++)i(t,e[a])}(c),!o.began&&o.currentTime>0&&(o.began=!0),function(t){for(var e=0,r=o.animations,n=r.length;e<n;){var a=r[e],i=a.animatable,s=a.tweens,c=s.length-1,f=s[c];c&&(f=l(s,(function(e){return t<e.end}))[0]||f);for(var d=u(t-f.start,0,f.duration)/f.duration,h=f.to.strings,p=f.round,g=[],m=f.to.numbers.length,v=void 0,y=0;y<m;y++){var b=void 0,x=f.to.numbers[y],w=f.from.numbers[y]||0;b=w+d*(x-w),p&&(f.isColor&&y>2||(b=Math.round(b*p)/p)),g.push(b)}var P=h.length;if(P){v=h[0];for(var C=0;C<P;C++){h[C];var k=h[C+1],M=g[C];isNaN(M)||(v+=k?M+k:M+" ")}}else v=g[0];V[a.type](i.target,a.property,v,i.transforms),a.currentValue=v,e++}}(c),o.currentTime=u(c,0,s),t>=s&&(o.paused=!0,o.completed||(o.completed=!0,!o.passThrough&&"Promise"in window&&(n(),a(o))))}return a(o),o.reset=function(){o.passThrough=!1,o.currentTime=0,o.progress=0,o.paused=!0,o.began=!1,o.completed=!1,o.reversePlayback=!1,e=o.children;for(var t=r=e.length;t--;)o.children[t].reset()},o.set=function(t,e){return N(t,e),o},o.seek=function(t){s(t)},o.reset(),o}function Y(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function B(t){for(var e,r=t.points,n=0,a=0;a<r.numberOfItems;a++){var o=r.getItem(a);a>0&&(n+=Y(e,o)),e=o}return n}function Z(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return function(t){return 2*Math.PI*w(t,"r")}(t);case"rect":return function(t){return 2*w(t,"width")+2*w(t,"height")}(t);case"line":return function(t){return Y({x:w(t,"x1"),y:w(t,"y1")},{x:w(t,"x2"),y:w(t,"y2")})}(t);case"polyline":return B(t);case"polygon":return function(t){var e=t.points;return B(t)+Y(e.getItem(e.numberOfItems-1),e.getItem(0))}(t)}}function q(t,e){var r=e||{},n=r.el||function(t){for(var e=t.parentNode;c.svg(e)&&c.svg(e.parentNode);)e=e.parentNode;return e}(t),a=n.getBoundingClientRect(),o=w(n,"viewBox"),i=a.width,u=a.height,s=r.viewBox||(o?o.split(" "):[0,0,i,u]);return{el:n,viewBox:s,x:s[0]/1,y:s[1]/1,w:i,h:u,vW:s[2],vH:s[3]}}X.version="3.1.0",X.get=A,X.set=N,X.convertPx=P,X.penner=f,X.path=function(t){return{el:t,svg:q(t),totalLength:Z(t),deltaCorrections:{x:4,y:5}}},X.getPathProgress=function(t,e,r){function n(r){void 0===r&&(r=0);var n=e*t.totalLength,a=n+r>=1?n+r:0;return t.el.getPointAtLength(a)}var a=q(t.el,t.svg),o=n(),i=n(-1),u=n(1);return{x:1*(o.x-a.x),y:1*(o.y-a.y),angle:180*Math.atan2(u.y-i.y,u.x-i.x)/Math.PI}};var H=X;class K extends r.default.ExtendableCSSEffect{onGetContext(){const t={};if(Object.prototype.hasOwnProperty.call(this.compoAttributes,this.attributeKey)){const e=this.compoAttributes[this.attributeKey];for(let r=0;r<e.length;r++)Object.prototype.hasOwnProperty.call(this.targetValue,e[r])&&(t[e[r]]=[this.initialValue[e[r]],this.targetValue[e[r]]])}else t[this.attributeKey]=[this.initialValue,this.targetValue];this.target=H({autoplay:!1,duration:this.props.duration,easing:"linear",targets:this.element,...(this.attrs||{}).attrs||{},...t})}onProgress(t){return this.target.seek(this.target.duration*this.getFraction(t))}}class R extends t.Effect{onGetContext(){this.pixelsAccuracy=this.attrs.pixelsAccuracy||4,this.calculatedPoints=[];const t=this.context.getElements(this.targetValue.pathElement)[0];this.path=H.path(t),this.isPathTargetInsideSVG=this.element instanceof SVGElement}onProgress(t){let e;const r=Math.round(this.path.totalLength/this.pixelsAccuracy*this.getFraction(t))*this.pixelsAccuracy;if(null!=this.calculatedPoints[r])e=this.calculatedPoints[r];else{const t=H.getPathProgress(this.path,r/this.path.totalLength,this.isPathTargetInsideSVG);e="\n            translateX(".concat(t.x,"px)\n            translateY(").concat(t.y,"px)\n            rotate(").concat(t.angle,"deg)\n        "),this.calculatedPoints[r]=e}this.element.style.transform=e}}return{npm_name:"@donkeyclip/motorcortex-anime",version:"3.1.0",CSSEffect:K,incidents:[{exportable:R,name:"MotionPath",attributesValidationRules:{animatedAttrs:{type:"object",props:{positionOn:{type:"object",props:{pathElement:{type:"string"}}}}}}}]}}));
